  
<html>
<script src='https://d3js.org/d3.v5.min.js'></script>


<style>
.chart rect { fill: steelblue; }
#tooltip {
    opacity: 0;
    position: absolute;
    text-align: center;
    width: 100px; height: 80px;
    background: white;
    border: 0px;
}
</style>

<body onload='init()'>
<svg width=700 height=700></svg>
<div id="tooltip"></div>



<script>

var color = d3.scaleOrdinal()
	.domain([0, 2, 3, 4, 6, 8, 10, 12])
	.range([ "green", "yellow", "yellow", "yellow", "gold", "orange", "red", "red"])

var dataAll = ["0", "2", "3", "4", "6", "8", "10", "12"];
var data12 = ["10","12"];
var data8 = ["8"];
var data6 = ["6"];
var data4 = ["2","3","4"];
var data0 = ["0"];


var margin = 50;
var height = 600;
var width = 600;

var x = d3.scaleLog().domain([10,150]).range([0,width]);
var y = d3.scaleLog().domain([10,150]).range([height,0]);

//var tooltip = d3.select("#tooltip");
var tooltip = d3.select("body")
    .append("div")
    .style("position", "absolute")
    .style("z-index", "10")
    .style("visibility", "hidden")
	.style("color", "blue")
	.style("font-weight",900)
//    .text("a simple tooltip");



//------------ Startup Chart -------------------------------


async function init() {
const data = await d3.csv('https://flunky.github.io/cars2017.csv');



d3.select("svg").append("g")
.attr("transform","translate("+margin+","+margin+")")
.call(d3.axisLeft(y).tickValues([10,20,50,100]).tickFormat(d3.format("~s")));

d3.select("svg").append("g")
.attr("transform","translate("+margin+","+(width+margin)+")")
.call(d3.axisBottom(x).tickValues([10,20,50,100]).tickFormat(d3.format("~s")));

d3.select('svg')
.append("g")
.attr("transform","translate("+margin+","+margin+")")
  .selectAll('circle')
  .data(data)
  .enter()
  .append('circle')
    .attr('cx',function(d,i) {return x(d.AverageCityMPG);})
    .attr('cy',function(d,i) {return y(d.AverageHighwayMPG);})
//	.transition().duration(500).delay(100)
    .attr('r',function(d,i) {return (parseInt(d.EngineCylinders,10)+2)*3;})
	.style("fill", function(d,i) {return color(parseInt(d.EngineCylinders,10));})
	.style("stroke", "grey")
	.style("opacity", 0.2)
	.on("mouseover", function(d,i){return tooltip
											.style("visibility", "visible")
											.text(d.Make+", "+d.Fuel+", "+d.EngineCylinders+" Cylinders");})		
	.on("mousemove", function(){return tooltip.style("top",
		(d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})
	.on("mouseout", function(){return tooltip.style("visibility", "hidden");});



}

async function update(cylinders) {
const data = await d3.csv('https://flunky.github.io/cars2017.csv');

//	var selectedData = data.filter(function(d){return d.EngineCylinders==cylinders});
	document.getElementById("demo").innerHTML = cylinders;
//	document.getElementById("demo").innerHTML = data;
	d3.select('svg').selectAll('*').remove();

	d3.select("svg").append("g")
	.attr("transform","translate("+margin+","+margin+")")
	.call(d3.axisLeft(y).tickValues([10,20,50,100]).tickFormat(d3.format("~s")));

	d3.select("svg").append("g")
	.attr("transform","translate("+margin+","+(width+margin)+")")
	.call(d3.axisBottom(x).tickValues([10,20,50,100]).tickFormat(d3.format("~s")));

	d3.select('svg')
	.append("g")
	.attr("transform","translate("+margin+","+margin+")")
	  .selectAll('circle')
	  .data(data.filter(function(d){return d.EngineCylinders == cylinders;}))
	  .enter()
	  .append('circle')
		.attr('cx',function(d,i) {return x(d.AverageCityMPG);})
		.attr('cy',function(d,i) {return y(d.AverageHighwayMPG);})
	//	.transition().duration(500).delay(100)
		.attr('r',function(d,i) {return (parseInt(d.EngineCylinders,10)+2)*3;})
		.style("fill", function(d,i) {return color(parseInt(d.EngineCylinders,10));})
		.style("stroke", "black")
		.style("opacity", 1)
		.on("mouseover", function(d,i){return tooltip
												.style("visibility", "visible")
												.text(d.Make+", "+d.Fuel+", "+d.EngineCylinders+" Cylinders");})		
		.on("mousemove", function(){return tooltip.style("top",
			(d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})
		.on("mouseout", function(){return tooltip.style("visibility", "hidden");});


}
</script>
<p>Click on the buttons to see the miles per gallon changes as the number of cylinders decrease:</p>

<p> 
Cylinders:
<button onclick="update(dataAll)">All Cars</button>
<button onclick="update(data12)">10-12 Cylinders</button>
<button onclick="update(data8)">8 Cylinders</button>
<button onclick="update(data6)">6 Cylinders</button>
<button onclick="update(data4)">1-4 Cylinders</button>
<button onclick="update(data0)">Electric</button>
</p>
<p id="demo"></p>
</body>

</html>
